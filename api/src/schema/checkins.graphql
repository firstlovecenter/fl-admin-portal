enum CheckInScopeLevel {
  OVERSIGHT
  CAMPUS
  STREAM
  COUNCIL
  GOVERNORSHIP
  BACENTA
}

enum CheckInAttendanceType {
  LEADERS_ONLY
  ALL
}

enum CheckInStatus {
  ACTIVE
  PAUSED
  ENDED
}

enum CheckInMethod {
  QR
  PIN
  MANUAL
}

enum CheckInRoleType {
  leaderBacenta
  leaderCouncil
  leaderStream
  leaderGovernorship
}

enum GeoFenceType {
  CIRCLE
  POLYGON
}

enum FaceMatchStatus {
  PENDING
  VERIFIED
  FLAGGED
  SKIPPED
}

input GeoPointInput {
  latitude: Float!
  longitude: Float!
}

input CreateCheckInEventInput {
  name: String!
  type: String!
  description: String
  location: String
  scopeLevel: CheckInScopeLevel!
  scopeId: ID!
  startsAt: DateTime!
  endsAt: DateTime!
  gracePeriod: Int
  attendanceType: CheckInAttendanceType!
  allowedCheckInRoles: [CheckInRoleType!]!
  geoVerifyEnabled: Boolean
  geoFenceType: GeoFenceType
  geoCenter: GeoPointInput
  geoRadius: Int
  geoPolygon: [GeoPointInput!]
  selfieRequired: Boolean
}

type GeoPoint {
  latitude: Float!
  longitude: Float!
}

type CheckInEvent {
  id: ID!
  name: String!
  type: String!
  description: String
  location: String
  scopeLevel: CheckInScopeLevel!
  scopeId: ID!
  startsAt: DateTime!
  endsAt: DateTime!
  gracePeriod: Int!
  attendanceType: CheckInAttendanceType!
  status: CheckInStatus!
  pinCode: String!
  qrToken: String!
  createdAt: DateTime!
  createdById: ID!
  createdByName: String!
  createdByRole: String!
  totalExpected: Int!
  allowedCheckInRoles: [CheckInRoleType!]!
  geoVerifyEnabled: Boolean!
  geoFenceType: GeoFenceType
  geoCenter: GeoPoint
  geoRadius: Int
  geoPolygon: [GeoPoint!]
  selfieRequired: Boolean!
}

type CheckInRecord {
  id: ID!
  eventId: ID!
  memberId: ID!
  memberName: String!
  memberRole: String!
  memberUnit: String!
  checkedInAt: DateTime!
  checkInMethod: CheckInMethod!
  verifiedBy: String!
  geoVerified: Boolean
  distanceFromVenue: Float
  selfieUrl: String
  faceMatchScore: Float
  faceMatchStatus: FaceMatchStatus
  deviceFingerprint: String
}

type CheckInAttendee {
  memberId: ID!
  firstName: String!
  lastName: String!
  fullName: String!
  roleLabel: String!
  unitName: String!
  unitType: String!
  checkedInAt: DateTime
  checkInMethod: CheckInMethod
  isLate: Boolean!
  geoVerified: Boolean
  faceMatchStatus: FaceMatchStatus
  selfieUrl: String
}

type CheckInStats {
  totalExpected: Int!
  checkedInCount: Int!
  defaultedCount: Int!
  percentage: Float!
  flaggedCount: Int!
}

type CheckInScopeFilter {
  id: ID!
  name: String!
  level: CheckInScopeLevel!
}

type FlaggedCheckIn {
  record: CheckInRecord!
  attendee: CheckInAttendee!
  reason: String!
}

type CheckInDashboard {
  event: CheckInEvent!
  checkedIn: [CheckInAttendee!]!
  defaulted: [CheckInAttendee!]!
  stats: CheckInStats!
  scopeFilters: [CheckInScopeFilter!]!
  appliedFilterId: ID
  flaggedRecords: [FlaggedCheckIn!]!
}

extend type Query {
  GetCheckInEvent(eventId: ID!): CheckInEvent!
  ListCheckInEvents(
    scopeLevel: CheckInScopeLevel
    scopeId: ID
    status: CheckInStatus
  ): [CheckInEvent!]!
  GetCheckInDashboard(eventId: ID!, filterScopeId: ID): CheckInDashboard!
  GetAdminScopes: [CheckInScopeFilter!]!
  GetFlaggedCheckIns(eventId: ID!): [FlaggedCheckIn!]!
}

extend type Mutation {
  CreateCheckInEvent(input: CreateCheckInEventInput!): CheckInEvent!
  CheckInMember(
    eventId: ID!
    method: CheckInMethod!
    code: String!
    deviceFingerprint: String!
    latitude: Float
    longitude: Float
    selfieBase64: String
    faceMatchScore: Float
    faceMatchStatus: FaceMatchStatus
  ): CheckInRecord!
  ManualCheckIn(eventId: ID!, memberId: ID!, reason: String): CheckInRecord!
  UpdateCheckInEventDuration(eventId: ID!, endsAt: DateTime!): CheckInEvent!
  PauseCheckInEvent(eventId: ID!): CheckInEvent!
  ResumeCheckInEvent(eventId: ID!): CheckInEvent!
  ResetCheckInEventPin(eventId: ID!): CheckInEvent!
  EndCheckInEvent(eventId: ID!): CheckInEvent!
  ResolveFlaggedCheckIn(recordId: ID!, resolution: String!): CheckInRecord!
}
